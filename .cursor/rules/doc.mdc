---
alwaysApply: true
---

## Общие правила проекта

-   Всегда используй `declare(strict_types=1);` в начале файлов
-   Следуй PSR-12 стандарту кодирования
-   Пиши тесты для всех изменений (Pest)
-   Обновляй документацию при изменении API

---

## Автоматические проверки PHPDoc

### Чек-лист перед каждым коммитом

При подготовке изменений к коммиту автоматически проверь:

1. **Соответствие сигнатур:**

    - [ ] Количество параметров в методе = количество `@param` в PHPDoc
    - [ ] Типы параметров совпадают с типами в `@param`
    - [ ] Тип возвращаемого значения совпадает с `@return`

2. **Полнота документации:**

    - [ ] Все публичные методы имеют PHPDoc
    - [ ] Все параметры конструктора документированы
    - [ ] Все свойства класса имеют `@var` аннотации
    - [ ] Все исключения указаны в `@throws`

3. **Актуальность описаний:**
    - [ ] Описание метода соответствует реальной логике
    - [ ] Описание параметров актуально
    - [ ] Указаны условия, при которых выбрасываются исключения

### Автоматическое обнаружение проблем

**Если обнаружил несоответствие:**

-   Немедленно исправь PHPDoc
-   Не коммить код с устаревшей документацией
-   Если не уверен в типе - проверь реальный тип в коде

### Примеры автоматических проверок

#### Проверка 1: Параметры метода

```php
// ❌ ОШИБКА: В методе 2 параметра, в PHPDoc только 1
/**
 * @param string $id
 */
public function find(string $id, bool $withTrashed): Entry

// ✅ ПРАВИЛЬНО: Все параметры документированы
/**
 * @param string $id ID записи
 * @param bool $withTrashed Включить удалённые записи
 */
public function find(string $id, bool $withTrashed): Entry
```

#### Проверка 2: Типы возвращаемых значений

```php
// ❌ ОШИБКА: Метод возвращает Entry|null, но в PHPDoc только Entry
/**
 * @return Entry
 */
public function find(int $id): ?Entry

// ✅ ПРАВИЛЬНО: Тип соответствует реальному
/**
 * @return \App\Models\Entry|null
 */
public function find(int $id): ?Entry
```

#### Проверка 3: Исключения

```php
// ❌ ОШИБКА: Метод выбрасывает исключение, но оно не документировано
public function create(array $data): Entry
{
    if (empty($data)) {
        throw new \InvalidArgumentException('Data is required');
    }
}

// ✅ ПРАВИЛЬНО: Исключение документировано
/**
 * @throws \InvalidArgumentException Если данные пусты
 */
public function create(array $data): Entry
```

### Приоритет обновления PHPDoc

**КРИТИЧНО (исправить немедленно):**

-   Несоответствие типов параметров
-   Отсутствующие параметры в `@param`
-   Неверный тип возвращаемого значения
-   Не документированные исключения

**ВАЖНО (исправить до коммита):**

-   Устаревшие описания методов
-   Отсутствующий PHPDoc для новых методов
-   Не документированные свойства

**ЖЕЛАТЕЛЬНО:**

-   Уточнение типов массивов (`array<string, mixed>`)
-   Дополнительные детали в описаниях
-   Примеры использования в комментариях

---

## Интеграция с workflow разработки

### При создании нового файла:

1. Сразу добавь PHPDoc для класса
2. Документируй конструктор
3. Документируй все публичные методы
4. Добавь `@var` для всех свойств

### При рефакторинге:

1. Обнови PHPDoc параллельно с кодом
2. Проверь все изменённые методы
3. Убедись, что типы актуальны

### При исправлении багов:

1. Если изменяется логика метода → обнови описание
2. Если добавляется проверка → добавь `@throws`
3. Если изменяется тип → обнови `@return` или `@param`

### При добавлении фичи:

1. Документируй новые методы сразу
2. Обнови описание класса, если изменилось назначение
3. Документируй новые зависимости в конструкторе

---

## Технические детали

### Поддерживаемые типы в PHPDoc:

-   Базовые: `string`, `int`, `bool`, `float`, `array`, `object`, `resource`, `callable`
-   Nullable: `string|null`, `?int`, `int|string|null`
-   Массивы: `array<string>`, `array<string, mixed>`, `array<int, Entry>`
-   Коллекции: `\Illuminate\Support\Collection<int, Entry>`
-   Eloquent: `\Illuminate\Database\Eloquent\Builder<Entry>`
-   Классы: `\App\Models\Entry`, `\App\Domain\Entries\EntrySlugService`

### Специальные аннотации:

-   `@var` - для свойств класса
-   `@param` - для параметров методов
-   `@return` - для возвращаемых значений
-   `@throws` - для исключений
-   `@package` - для namespace пакета
-   `@deprecated` - для устаревших методов
-   `@see` - для ссылок на связанные сущности

### Формат описаний:

-   Первая строка - краткое описание (до 80 символов)
-   Пустая строка
-   Дополнительные строки - подробное описание
-   Аннотации (`@param`, `@return`, `@throws`) - после описания

---

**ПОМНИ:** PHPDoc - это не просто комментарии, это контракт между кодом и документацией. Несоответствие PHPDoc реальному коду вводит в заблуждение и снижает продуктивность разработки.
