---
owner: "@backend-team"
system_of_record: "narrative"
review_cycle_days: 365
last_reviewed: 2025-11-09
related_code:
    - "config/jwt.php"
    - "app/Support/JwtCookies.php"
    - "app/Http/Middleware/JwtAuth.php"
---

# ADR-0001: Use JWT (HS256) for API Authentication

**Status**: Accepted

**Date**: 2025-11-08

**Deciders**: Backend team

---

## Context

stupidCms ‚Äî headless CMS —Å RESTful API. –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è:

-   Admin API (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
-   –ó–∞—â–∏—â—ë–Ω–Ω—ã—Ö endpoints (–Ω–∞–ø—Ä–∏–º–µ—Ä, user profile)
-   –í–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, SPA –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

-   Stateless (–±–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ) –¥–ª—è API
-   –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (multiple app instances –±–µ–∑ shared state)
-   HTTP-only cookies –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
-   Refresh tokens –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞–¥–º–∏–Ω–∫–∏ (Blade, `/admin/*`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è **session-based** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Laravel, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç stateless –ø–æ–¥—Ö–æ–¥–∞.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**:

1. Session-based authentication (Laravel default)
2. JWT —Å HS256
3. JWT —Å RS256
4. OAuth 2.0

---

## Decision

–ò—Å–ø–æ–ª—å–∑—É–µ–º **JWT —Ç–æ–∫–µ–Ω—ã —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º HS256** –¥–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:

-   **Stateless**: —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (user_id, exp)
-   **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª—é–±–æ–π app instance –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω
-   **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: HS256 —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç (`JWT_SECRET`)
-   **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –±—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
-   **HTTP-only cookies**: —Ö—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω –≤ secure cookie (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)

---

## Alternatives Considered

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 1: Session-based Auth

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–µ—Å—Å–∏–æ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Laravel (cookies + session store).

**–ü–ª—é—Å—ã**:

-   ‚úÖ Built-in –≤ Laravel
-   ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
-   ‚úÖ –õ–µ–≥–∫–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Å—Å–∏–∏

**–ú–∏–Ω—É—Å—ã**:

-   ‚ùå –¢—Ä–µ–±—É–µ—Ç shared session store (Redis, DB) –º–µ–∂–¥—É instances
-   ‚ùå Stateful ‚Äî —É—Å–ª–æ–∂–Ω—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
-   ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è headless API (cookies tied to domain)

**–ü–æ—á–µ–º—É –æ—Ç–≤–µ—Ä–≥–ª–∏ –¥–ª—è API**: stupidCms ‚Äî headless CMS, –≤–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö. Session-based –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CORS-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ (Blade) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç session-based auth, —Ç–∞–∫ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ (`/admin/*`).

---

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 2: JWT —Å RS256

**–û–ø–∏—Å–∞–Ω–∏–µ**: JWT —Å –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º (private key –¥–ª—è sign, public key –¥–ª—è verify).

**–ü–ª—é—Å—ã**:

-   ‚úÖ Public key –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ
-   ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (–∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–∫–µ–Ω—ã)

**–ú–∏–Ω—É—Å—ã**:

-   ‚ùå –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π)
-   ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ HS256
-   ‚ùå –ò–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –º–æ–Ω–æ–ª–∏—Ç–∞

**–ü–æ—á–µ–º—É –æ—Ç–≤–µ—Ä–≥–ª–∏**: stupidCms ‚Äî –º–æ–Ω–æ–ª–∏—Ç, –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–≤–µ—Ä—è—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É. –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –∏–∑–±—ã—Ç–æ—á–Ω–∞.

---

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 3: OAuth 2.0

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å access/refresh tokens, scopes –∏ —Ç.–¥.

**–ü–ª—é—Å—ã**:

-   ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
-   ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ third-party auth (Google, GitHub)

**–ú–∏–Ω—É—Å—ã**:

-   ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
-   ‚ùå –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ CMS
-   ‚ùå –¢—Ä–µ–±—É–µ—Ç OAuth-—Å–µ—Ä–≤–µ—Ä

**–ü–æ—á–µ–º—É –æ—Ç–≤–µ—Ä–≥–ª–∏**: –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è third-party auth, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ.

---

## Consequences

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ ‚úÖ

-   **Stateless API**: –Ω–µ –Ω—É–∂–µ–Ω shared session store
-   **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î
-   **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
-   **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –æ–¥–∏–Ω —Å–µ–∫—Ä–µ—Ç –≤ `.env`
-   **–ì–∏–±–∫–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å claims (roles, permissions) –≤ payload

### –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ‚ùå

-   **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤**: –Ω–µ–ª—å–∑—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–∫–µ–Ω (–æ–Ω –≤–∞–ª–∏–¥–µ–Ω –¥–æ `exp`)
    -   _–ú–∏—Ç–∏–≥–∞—Ü–∏—è_: –∫–æ—Ä–æ—Ç–∫–∏–π TTL (1 —á–∞—Å) + refresh tokens
-   **–†–∞–∑–º–µ—Ä**: JWT —Ç–æ–∫–µ–Ω—ã –±–æ–ª—å—à–µ, —á–µ–º session ID (–ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ)
    -   _–ú–∏—Ç–∏–≥–∞—Ü–∏—è_: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP-only cookies (–Ω–µ –≤ headers)
-   **–°–µ–∫—Ä–µ—Ç**: –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ `JWT_SECRET` –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ–≤–∞–ª–∏–¥–Ω—ã
    -   _–ú–∏—Ç–∏–≥–∞—Ü–∏—è_: —Ö—Ä–∞–Ω–∏—Ç—å –≤ `.env`, –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Ä–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–∞

### –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ ‚ö†Ô∏è

-   –¢—Ä–µ–±—É–µ—Ç –∑–∞—â–∏—Ç—ã `JWT_SECRET` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å, –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å)
-   –¢–æ–∫–µ–Ω—ã –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–ª–∏—Ç—å (–Ω—É–∂–Ω—ã refresh tokens)
-   Payload –≤–∏–¥–∏–º (base64, –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω) ‚Äî –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## Implementation

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∫–µ–Ω–∞

**Access Token** (–∫–æ—Ä–æ—Ç–∫–∏–π TTL, 1 —á–∞—Å):

```json
{
    "sub": 123, // user_id
    "exp": 1699459200, // expiration time
    "iat": 1699455600, // issued at
    "role": "admin" // user role
}
```

**Refresh Token** (–¥–ª–∏–Ω–Ω—ã–π TTL, 30 –¥–Ω–µ–π):

```json
{
    "sub": 123,
    "exp": 1702047600,
    "type": "refresh"
}
```

Refresh —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î (`refresh_tokens` —Ç–∞–±–ª–∏—Ü–∞) –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞.

### –•—Ä–∞–Ω–µ–Ω–∏–µ

-   **Access Token**: HTTP-only cookie `access_token`
-   **Refresh Token**: HTTP-only cookie `refresh_token`

### Endpoints

-   `POST /api/auth/login` ‚Äî –≤—ã–¥–∞—ë—Ç access + refresh tokens
-   `POST /api/auth/refresh` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç access token —á–µ—Ä–µ–∑ refresh token
-   `POST /api/auth/logout` ‚Äî —É–¥–∞–ª—è–µ—Ç refresh token –∏–∑ –ë–î

### Middleware

`JwtAuth` middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `access_token` cookie:

1. –ò–∑–≤–ª–µ—á—å —Ç–æ–∫–µ–Ω –∏–∑ cookie
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å (`JWT_SECRET`)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `exp`
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `sub`
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `auth()->user()`

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                         | –¢–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | Middleware        | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ                                  |
| --------------------------------- | ------------------ | ----------------- | ---------------------------------------------- |
| **Admin API** (`/api/v1/admin/*`) | JWT                | `api`, `auth:jwt` | –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã (–º–æ–±–∏–ª—å–Ω—ã–µ, SPA)               |
| **Public API** (`/api/*`)         | JWT (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)  | `api`             | –ü—É–±–ª–∏—á–Ω—ã–µ endpoints + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| **–ê–¥–º–∏–Ω–∫–∞** (`/admin/*`)          | Session-based      | `web`, `auth`     | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è Blade-–∞–¥–º–∏–Ω–∫–∞                       |

---

## References

-   [RFC 7519: JSON Web Token (JWT)](https://tools.ietf.org/html/rfc7519)
-   [OWASP: JWT Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_for_Java_Cheat_Sheet.html)
-   [HS256 vs RS256](https://auth0.com/blog/rs256-vs-hs256-whats-the-difference/)
-   [JWT.io Debugger](https://jwt.io/)

---

## History

| Date       | Change   | Author        |
| ---------- | -------- | ------------- |
| 2025-11-08 | Created  | @backend-team |
| 2025-11-08 | Accepted | @team         |

---

> üí° **Future Consideration**: –ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–ª–∏ third-party integrations, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ RS256. –°–º. [ADR Template](adr-template.md) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ ADR.
