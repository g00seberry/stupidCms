# План актуализации PHPDoc документации контроллеров

## Цель
Проверить и актуализировать PHPDoc аннотации (Scribe) во всех контроллерах проекта, чтобы документация соответствовала реальному коду.

## Область работы

### Контроллеры для проверки (23 файла):

#### Admin API (V1) - 13 контроллеров
1. `PostTypeController` - CRUD для типов записей
2. `EntryController` - CRUD для записей
3. `TaxonomyController` - CRUD для таксономий
4. `TermController` - CRUD для терминов
5. `MediaController` - CRUD для медиафайлов
6. `MediaPreviewController` - превью медиа
7. `OptionsController` - управление опциями
8. `PluginsController` - управление плагинами
9. `TemplateController` - управление шаблонами
10. `UtilsController` - утилиты (slugify)
11. `SearchAdminController` - админский поиск
12. `PathReservationController` - резервирование путей
13. `EntryTermsController` - привязка терминов к записям

#### Auth API - 4 контроллера
14. `LoginController` - вход
15. `LogoutController` - выход
16. `RefreshController` - обновление токена
17. `CurrentUserController` - текущий пользователь

#### Public API - 1 контроллер
18. `SearchController` - публичный поиск

#### Web контроллеры (не требуют Scribe) - 4 контроллера
19. `HomeController` - главная страница
20. `PageController` - публичные страницы
21. `FallbackController` - 404 обработчик
22. `AdminPingController` - ping эндпоинт

#### Базовый класс
23. `Controller` - базовый класс (не требует документации)

## Критерии проверки

### 1. Обязательные аннотации для каждого метода API

- `@group` - группа в документации (например: "Admin ▸ Post types")
- `@name` - название метода (например: "Create post type")
- `@authenticated` или `@unauthenticated` - требование аутентификации
- `@urlParam` - параметры URL (если есть)
- `@queryParam` - query параметры (если есть)
- `@bodyParam` - параметры тела запроса (для POST/PUT/PATCH)
- `@response` - примеры ответов для всех возможных статусов

### 2. Проверка соответствия документации коду

#### Параметры запроса
- [ ] Все `@bodyParam` соответствуют правилам валидации в FormRequest
- [ ] Все `@queryParam` соответствуют правилам валидации в FormRequest
- [ ] Типы параметров корректны (string, int, object, array и т.д.)
- [ ] Обязательность параметров указана (required/optional/sometimes)
- [ ] Примеры значений актуальны

#### Ответы API
- [ ] Все возможные статусы документированы (200, 201, 400, 401, 403, 404, 409, 422, 429, 500)
- [ ] Примеры `@response` соответствуют реальным Resource классам
- [ ] Структура ответов актуальна (все поля из Resource присутствуют)
- [ ] Примеры ошибок соответствуют ErrorCode и ErrorFactory

#### URL параметры
- [ ] Все `@urlParam` соответствуют параметрам роутов
- [ ] Типы и описания корректны

### 3. Проверка актуальности

- [ ] Новые поля в Request добавлены в `@bodyParam`
- [ ] Удаленные поля удалены из `@bodyParam`
- [ ] Изменения в Resource отражены в `@response`
- [ ] Новые статусы ошибок документированы

## Детальный план выполнения

### Этап 1: Подготовка и анализ (30 мин)

1. **Создать чеклист для каждого контроллера**
   - Список всех методов
   - Список FormRequest классов
   - Список Resource классов
   - Список возможных ErrorCode

2. **Собрать информацию о текущем состоянии**
   - Какие контроллеры имеют полную документацию
   - Какие контроллеры требуют обновления
   - Выявить типичные проблемы

### Этап 2: Актуализация Admin API контроллеров (2-3 часа)

#### 2.1 PostTypeController (30 мин)
- [ ] Проверить метод `store` - все параметры документированы
- [ ] **ИСПРАВИТЬ:** Метод `update` - добавить `@bodyParam template string optional`
- [ ] Проверить все `@response` примеры
- [ ] Проверить соответствие Resource (должен включать `template`)

#### 2.2 EntryController (45 мин)
- [ ] Метод `index` - проверить все query параметры
- [ ] Метод `store` - проверить все body параметры
- [ ] Метод `update` - проверить все body параметры
- [ ] Метод `show` - проверить структуру ответа
- [ ] Метод `destroy` - проверить статусы ответов
- [ ] Метод `restore` - проверить документацию
- [ ] Проверить все возможные статусы ошибок

#### 2.3 MediaController (30 мин)
- [ ] Метод `index` - проверить query параметры
- [ ] Метод `store` - проверить body параметры (file upload)
- [ ] Метод `update` - проверить body параметры
- [ ] Метод `show` - проверить структуру ответа
- [ ] Метод `destroy` - проверить статус 409 (media in use)
- [ ] Метод `restore` - проверить документацию

#### 2.4 TaxonomyController (30 мин)
- [ ] Метод `index` - проверить query параметры
- [ ] Метод `store` - проверить body параметры
- [ ] Метод `update` - проверить body параметры
- [ ] Метод `show` - проверить структуру ответа
- [ ] Метод `destroy` - проверить статус 409 (terms exist)

#### 2.5 TermController (30 мин)
- [ ] Метод `index` - проверить query параметры
- [ ] Метод `store` - проверить body параметры
- [ ] Метод `update` - проверить body параметры
- [ ] Метод `show` - проверить структуру ответа
- [ ] Метод `destroy` - проверить статус 409 (attached to entries)

#### 2.6 Остальные Admin контроллеры (1 час)
- [ ] `OptionsController` - проверить все методы
- [ ] `PluginsController` - проверить все методы
- [ ] `TemplateController` - проверить все методы
- [ ] `UtilsController` - проверить метод slugify
- [ ] `SearchAdminController` - проверить метод reindex
- [ ] `PathReservationController` - проверить все методы
- [ ] `EntryTermsController` - проверить attach/detach/sync
- [ ] `MediaPreviewController` - проверить метод preview

### Этап 3: Актуализация Auth контроллеров (30 мин)

- [ ] `LoginController::login` - проверить body параметры, response headers (Set-Cookie)
- [ ] `LogoutController::logout` - проверить документацию
- [ ] `RefreshController::refresh` - проверить body параметры, response headers
- [ ] `CurrentUserController::show` - проверить структуру ответа

### Этап 4: Актуализация Public API (15 мин)

- [ ] `SearchController::index` - проверить query параметры, структуру ответа

### Этап 5: Проверка соответствия FormRequest (1 час)

Для каждого контроллера:
1. Открыть соответствующий FormRequest
2. Сравнить правила валидации с `@bodyParam`/`@queryParam`
3. Убедиться, что все поля документированы
4. Проверить типы и обязательность

### Этап 6: Проверка соответствия Resource (1 час)

Для каждого контроллера:
1. Открыть соответствующий Resource класс
2. Сравнить метод `toArray()` с примерами в `@response`
3. Убедиться, что все поля присутствуют в примерах
4. Проверить структуру вложенных объектов

### Этап 7: Проверка ErrorCode (30 мин)

- [ ] Убедиться, что все возможные ошибки документированы
- [ ] Проверить соответствие ErrorCode в `@response` реальным кодам
- [ ] Проверить структуру error responses

### Этап 8: Генерация и проверка документации (30 мин)

1. Запустить `composer docs:gen`
2. Открыть `docs/_generated/api-docs/index.html`
3. Проверить визуально все эндпоинты
4. Убедиться, что примеры запросов/ответов корректны
5. Проверить, что все группы отображаются правильно

### Этап 9: Финальная проверка (30 мин)

1. Запустить `php artisan test` - убедиться, что ничего не сломалось
2. Проверить, что все изменения соответствуют стандартам проекта
3. Убедиться, что нет опечаток в документации

## Известные проблемы

### PostTypeController
- ❌ Метод `update` не документирует параметр `template` (добавлен недавно)

## Шаблон для проверки метода

```php
/**
 * Описание метода.
 *
 * @group Admin ▸ Resource Name
 * @name Action name
 * @authenticated
 * @urlParam id int required ID ресурса. Example: 42
 * @queryParam filter string Фильтр. Example: active
 * @bodyParam field string required Описание. Example: value
 * @response status=200 {
 *   "data": {
 *     "id": 42,
 *     "field": "value"
 *   }
 * }
 * @response status=401 { ... }
 * @response status=403 { ... }
 * @response status=404 { ... }
 * @response status=422 { ... }
 */
```

## Критерии готовности

- [ ] Все 18 API контроллеров проверены
- [ ] Все методы имеют полную документацию
- [ ] Все параметры соответствуют FormRequest
- [ ] Все ответы соответствуют Resource
- [ ] Все возможные статусы документированы
- [ ] Документация сгенерирована и проверена визуально
- [ ] Все тесты проходят
- [ ] Нет опечаток и неточностей

## Оценка времени

- **Общее время:** 6-7 часов
- **Этап 1:** 30 мин
- **Этап 2:** 2-3 часа
- **Этап 3:** 30 мин
- **Этап 4:** 15 мин
- **Этап 5:** 1 час
- **Этап 6:** 1 час
- **Этап 7:** 30 мин
- **Этап 8:** 30 мин
- **Этап 9:** 30 мин

## Приоритеты

1. **Высокий:** PostTypeController (известная проблема)
2. **Высокий:** EntryController (основной функционал)
3. **Средний:** MediaController, TaxonomyController, TermController
4. **Средний:** Auth контроллеры
5. **Низкий:** Остальные контроллеры

